# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## What This Is

Webhook Inspector API — a Fastify REST API that captures, stores, and inspects incoming webhook HTTP requests. It logs the full request details (method, headers, body, query params) into PostgreSQL for later inspection.

## Commands

- `pnpm dev` — start dev server with hot reload (port 3333)
- `pnpm run format` — format code with Biome
- `pnpm run db:generate` — generate Drizzle migrations from schema changes
- `pnpm run db:migrate` — apply migrations to database
- `pnpm run db:studio` — open Drizzle Studio GUI
- `pnpm run db:seed` — seed the database
- `docker compose up -d` — start PostgreSQL (required before running the app)

## Architecture

**Stack:** Fastify 5 + Drizzle ORM + PostgreSQL 17 + Zod validation + TypeScript

**Path alias:** `@/*` maps to `./src/*` (configured in tsconfig and used throughout imports)

**Key patterns:**
- Routes are Fastify plugins (`FastifyPluginAsyncZod`) registered in `src/server.ts`
- Schemas are validated with Zod at both request and response level via `fastify-type-provider-zod`
- Response schemas are auto-derived from Drizzle tables using `drizzle-zod`'s `createSelectSchema`
- Drizzle uses `snake_case` casing mode — TypeScript fields are camelCase, DB columns are snake_case
- Primary keys use UUIDv7 (time-sortable) generated by `$defaultFn`
- List endpoint uses cursor-based pagination (cursor = last item's UUIDv7 id)

**Two route groups:**
- `/capture/*` — external-facing catch-all (any HTTP method) that stores incoming webhook requests
- `/api/webhooks` — internal CRUD endpoints for listing, getting, and deleting stored webhooks

**API docs** are served at `/docs` via Scalar (OpenAPI/Swagger).

## Code Style

- Biome for formatting: 2-space indent, single quotes, no semicolons
- Environment variables are validated with Zod in `src/env.ts` — always import `env` from `@/env`
